!function(){const e=12,t={setup:document.getElementById("setup"),intro:document.getElementById("intro"),quiz:document.getElementById("quiz"),review:document.getElementById("review"),done:document.getElementById("done"),webhook:document.getElementById("webhook"),playerName:document.getElementById("playerName"),startBtn:document.getElementById("startBtn"),beginQuizBtn:document.getElementById("beginQuizBtn"),sampleNumber:document.getElementById("sampleNumber"),options:document.getElementById("flavourOptions"),allFlavoursPills:document.getElementById("allFlavoursPills"),nextBtn:document.getElementById("nextBtn"),skipBtn:document.getElementById("skipBtn"),bar:document.getElementById("bar"),progressText:document.getElementById("progressText"),editsLeft:document.getElementById("editsLeft"),reviewList:document.getElementById("reviewList"),finalizeBtn:document.getElementById("finalizeBtn"),resultBlock:document.getElementById("resultBlock"),downloadCsv:document.getElementById("downloadCsv"),copyJson:document.getElementById("copyJson")};let n=["Ketchup","Spaghetti","Cotton Candy","Pumpkin Pie","Pickle","Buffalo Wing","Ranch Dressing","Sweet Corn","Peanut Butter & Jelly","Bacon","Birthday Cake","Cucumber"],o=Array.from({length:e},(e,t)=>t+1),l=Array(e).fill(null),a=0,s=2,r=null,d=!1;const i=e=>new Date(e).toISOString(),c=(e,t,n)=>Math.max(t,Math.min(n,e));function m(){const e={flavours:n,order:o,answers:l,current:a,editsRemaining:s,startedAt:r,submitted:d,playerName:t.playerName.value,webhook:t.webhook.value};localStorage.setItem("weirdSodaQuiz",JSON.stringify(e))}function u(e,t={},n=[]){const o=document.createElement(e);Object.assign(o,t);for(const e of n)"string"==typeof e?o.appendChild(document.createTextNode(e)):e&&o.appendChild(e);return o}function p(){t.allFlavoursPills.innerHTML="",n.forEach((e,n)=>{t.allFlavoursPills.appendChild(u("div",{className:"pill"},[u("span",{className:"kbd"},[`#${n+1}`]),u("span",{},[e||"(blank)"])]))})}function h(){const n=l.filter(e=>null!==e).length;t.progressText.textContent=`${n}/12 answered`,t.bar.style.width=`${Math.round(n/e*100)}%`,t.sampleNumber.textContent=o[a]}function v(){t.options.innerHTML="";const s={};l.forEach((e,t)=>{null!==e&&t!==a&&(s[e]=o[t])});for(let o=0;o<e;o++){const e=`opt${o}`,r=s[o],d=void 0!==r,i=u("label",{className:d?"opt opt-used":"opt"}),c=u("input",{type:"radio",name:"flavour",id:e,value:o});d&&(c.disabled=!0,i.style.pointerEvents="none"),c.addEventListener("change",()=>{l[a]=o});const m=u("span",{},[n[o]||`(blank #${o+1})`]);if(i.appendChild(c),i.appendChild(m),d){const e=u("span",{className:"used-indicator"},[`Sample ${r}`]);i.appendChild(e)}t.options.appendChild(i)}if(null!=l[a]){const e=document.getElementById(`opt${l[a]}`);e&&(e.checked=!0)}}function y(e=!1){e||null!=l[a]?a<11?(a++,v(),h(),m(),window.scrollTo({top:0,behavior:"smooth"})):(t.quiz.classList.add("hidden"),t.review.classList.remove("hidden"),f(),m(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please pick a flavour or tap Skip.")}function f(){t.reviewList.innerHTML="",t.editsLeft.textContent=s;for(let a=0;a<e;a++){const e=o[a],s=l[a],r=null==s?"(no guess)":n[s]||`(blank #${s+1})`,d=u("div",{className:"opt",role:"button",tabIndex:0});d.appendChild(u("span",{className:"kbd"},[`Sample ${e}`])),d.appendChild(u("span",{},[r]));const i=u("span",{className:"muted",style:"margin-left:auto;font-size:12px"},["Edit"]);d.appendChild(i),d.addEventListener("click",()=>g(a)),d.addEventListener("keypress",e=>{"Enter"===e.key&&g(a)}),t.reviewList.appendChild(d)}}function g(t){if(s<=0)return void alert("No edits left.");const a=l[t],r=u("div",{className:"list"}),d=u("div",{},[`Change Sample ${o[t]}`]),i=u("select",{});for(let t=0;t<e;t++){const e=u("option",{value:t,text:n[t]||`(blank #${t+1})`});t===a&&(e.selected=!0),i.appendChild(e)}const c=u("button",{className:"good"},["Save change (-1 edit)"]),p=u("button",{className:"ghost"},["Cancel"]),h=u("dialog",{},[r]);r.appendChild(d),r.appendChild(i);const v=u("div",{className:"row"},[c,p]);if(r.appendChild(v),document.body.appendChild(h),!h.showModal)return alert("Your browser blocks modals; cannot edit here. Try another browser."),void h.remove();h.showModal(),c.addEventListener("click",()=>{l[t]=parseInt(i.value,10),s--,m(),h.close(),h.remove(),f()}),p.addEventListener("click",()=>{h.close(),h.remove()})}t.startBtn.addEventListener("click",()=>{t.playerName.value.trim()?(o=Array.from({length:e},(e,t)=>t+1),(e=>{for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}})(o),l=Array(e).fill(null),a=0,s=2,r=i(new Date),d=!1,m(),t.setup.classList.add("hidden"),t.quiz.classList.remove("hidden"),v(),p(),h(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please enter your name.")}),t.beginQuizBtn.addEventListener("click",()=>{t.intro.classList.add("hidden"),t.quiz.classList.remove("hidden"),v(),p(),h(),window.scrollTo({top:0,behavior:"smooth"})}),t.nextBtn.addEventListener("click",()=>y(!1)),t.skipBtn.addEventListener("click",()=>y(!0)),t.finalizeBtn.addEventListener("click",function(){if(l.some(e=>null==e)&&!confirm("Some answers are blank. Finalize anyway?"))return;const e=new Date,a={player:t.playerName.value.trim()||"Anonymous",startedAt:r||i(e),submittedAt:i(e),flavours:[...n],order:[...o],answers:[...l],resolved:l.map(e=>null==e?null:n[e]||null)};d=!0,m(),t.resultBlock.innerHTML="",t.review.classList.add("hidden"),t.done.classList.remove("hidden");const s=t.webhook.value.trim();if(s)try{const e=s+"?data="+encodeURIComponent(JSON.stringify(a));fetch(e,{method:"GET",mode:"no-cors"}).then(()=>{const e=u("p",{className:"small muted"},["âœ“ Results sent to webhook"]);t.resultBlock.appendChild(e)}).catch(e=>{const n=u("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)})}catch(e){const n=u("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)}}),t.downloadCsv.addEventListener("click",function(){const e=new Date,a={player:t.playerName.value.trim()||"Anonymous",startedAt:r,submittedAt:i(e),flavours:[...n],order:[...o],answers:[...l],resolved:l.map(e=>null==e?null:n[e]||null)},s=["player","submittedAt",...o.map(e=>`Sample${e}`),...o.map(e=>`Sample${e}_index`)].join(",")+"\n"+function(e){return[e.player,e.submittedAt,...e.resolved.map(e=>e??""),...e.answers.map(e=>null==e?"":e+1)].map(e=>(e=String(e),/[",\n]/.test(e)?'"'+e.replace(/"/g,'""')+'"':e)).join(",")}(a),d=new Blob([s],{type:"text/csv"}),c=document.createElement("a"),m=a.player.replace(/[^a-z0-9]+/gi,"_").replace(/^_+|_+$/g,"");c.download=`weird-soda-${m||"anonymous"}.csv`,c.href=URL.createObjectURL(d),c.click(),setTimeout(()=>URL.revokeObjectURL(c.href),2e3)}),t.copyJson.addEventListener("click",function(){const e=new Date,a={player:t.playerName.value.trim()||"Anonymous",startedAt:r,submittedAt:i(e),flavours:[...n],order:[...o],answers:[...l],resolved:l.map(e=>null==e?null:n[e]||null)};navigator.clipboard.writeText(JSON.stringify(a)).then(()=>{alert("Results copied to clipboard.")}).catch(()=>{alert("Copy failed. Select and copy from the box manually.")})}),function(){const i=localStorage.getItem("weirdSodaQuiz");if(i)try{const m=JSON.parse(i);Array.isArray(m.flavours)&&m.flavours.length===e&&(n=m.flavours,o=m.order??o,l=m.answers??l,a=c(m.current??0,0,11),s=c(m.editsRemaining??2,0,2),r=m.startedAt??null,d=!!m.submitted,t.playerName.value=m.playerName??"",t.webhook.value=m.webhook??"")}catch(e){console.warn("restore failed",e)}}(),function(){const e=new URLSearchParams(window.location.search).get("webhook");e&&(t.webhook.value=decodeURIComponent(e),m())}()}();