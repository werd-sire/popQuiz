!function(){const e=12,t={setup:document.getElementById("setup"),intro:document.getElementById("intro"),quiz:document.getElementById("quiz"),review:document.getElementById("review"),done:document.getElementById("done"),webhook:document.getElementById("webhook"),playerName:document.getElementById("playerName"),startBtn:document.getElementById("startBtn"),beginQuizBtn:document.getElementById("beginQuizBtn"),sampleNumber:document.getElementById("sampleNumber"),options:document.getElementById("flavourOptions"),nextBtn:document.getElementById("nextBtn"),skipBtn:document.getElementById("skipBtn"),bar:document.getElementById("bar"),progressText:document.getElementById("progressText"),editsLeft:document.getElementById("editsLeft"),reviewList:document.getElementById("reviewList"),finalizeBtn:document.getElementById("finalizeBtn"),resultBlock:document.getElementById("resultBlock")};let n=["Root Beer","Hot Dog Water","Banana","Super Sour Grape (Pucker Up Grape)","Pickle Pop","Spaghetti","RC Cola","Cotton Candy","Super Sour Blueberry (Bad Temper Blueberry)","Coca-Cola","Bubble Gum","Ketchup Soda"],o=Array.from({length:e},(e,t)=>t+1),a=Array(e).fill(null),l=0,s=2,d=null,r=!1;const i=e=>new Date(e).toISOString(),c=(e,t,n)=>Math.max(t,Math.min(n,e));function u(){const e={flavours:n,order:o,answers:a,current:l,editsRemaining:s,startedAt:d,submitted:r,playerName:t.playerName.value,webhook:t.webhook.value};localStorage.setItem("weirdSodaQuiz",JSON.stringify(e))}function m(e,t={},n=[]){const o=document.createElement(e);Object.assign(o,t);for(const e of n)"string"==typeof e?o.appendChild(document.createTextNode(e)):e&&o.appendChild(e);return o}function p(){const n=a.filter(e=>null!==e).length;t.progressText.textContent=`${n}/12 answered`,t.bar.style.width=`${Math.round(n/e*100)}%`,t.sampleNumber.textContent=o[l]}function h(){t.options.innerHTML="";const s={};a.forEach((e,t)=>{null!==e&&t!==l&&(s[e]=o[t])});for(let o=0;o<e;o++){const e=`opt${o}`,d=s[o],r=void 0!==d,i=m("label",{className:r?"opt opt-used":"opt"}),c=m("input",{type:"radio",name:"flavour",id:e,value:o});r&&(c.disabled=!0,i.style.pointerEvents="none"),c.addEventListener("change",()=>{a[l]=o});const u=m("span",{},[n[o]||`(blank #${o+1})`]);if(i.appendChild(c),i.appendChild(u),r){const e=m("span",{className:"used-indicator"},[`Sample ${d}`]);i.appendChild(e)}t.options.appendChild(i)}if(null!=a[l]){const e=document.getElementById(`opt${a[l]}`);e&&(e.checked=!0)}}function v(e=!1){e||null!=a[l]?l<11?(l++,h(),p(),u(),window.scrollTo({top:0,behavior:"smooth"})):(t.quiz.classList.add("hidden"),t.review.classList.remove("hidden"),g(),u(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please pick a flavour or tap Skip.")}function g(){t.reviewList.innerHTML="",t.editsLeft.textContent=s;for(let l=0;l<e;l++){const e=o[l],s=a[l],d=null==s?"(no guess)":n[s]||`(blank #${s+1})`,r=m("div",{className:"opt",role:"button",tabIndex:0});r.appendChild(m("span",{className:"kbd"},[`Sample ${e}`])),r.appendChild(m("span",{},[d]));const i=m("span",{className:"muted",style:"margin-left:auto;font-size:12px"},["Edit"]);r.appendChild(i),r.addEventListener("click",()=>f(l)),r.addEventListener("keypress",e=>{"Enter"===e.key&&f(l)}),t.reviewList.appendChild(r)}}function f(t){if(s<=0)return void alert("No edits left.");const l=a[t],d=m("div",{className:"list"}),r=m("div",{},[`Change Sample ${o[t]}`]),i=m("select",{});for(let t=0;t<e;t++){const e=m("option",{value:t,text:n[t]||`(blank #${t+1})`});t===l&&(e.selected=!0),i.appendChild(e)}const c=m("button",{className:"good"},["Save change (-1 edit)"]),p=m("button",{className:"ghost"},["Cancel"]),h=m("dialog",{},[d]);d.appendChild(r),d.appendChild(i);const v=m("div",{className:"row"},[c,p]);if(d.appendChild(v),document.body.appendChild(h),!h.showModal)return alert("Your browser blocks modals; cannot edit here. Try another browser."),void h.remove();h.showModal(),c.addEventListener("click",()=>{a[t]=parseInt(i.value,10),s--,u(),h.close(),h.remove(),g()}),p.addEventListener("click",()=>{h.close(),h.remove()})}t.startBtn.addEventListener("click",()=>{t.playerName.value.trim()?(o=Array.from({length:e},(e,t)=>t+1),(e=>{for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}})(o),a=Array(e).fill(null),l=0,s=2,d=i(new Date),r=!1,u(),t.setup.classList.add("hidden"),t.quiz.classList.remove("hidden"),h(),p(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please enter your name.")}),t.beginQuizBtn.addEventListener("click",()=>{t.intro.classList.add("hidden"),t.quiz.classList.remove("hidden"),h(),p(),window.scrollTo({top:0,behavior:"smooth"})}),t.nextBtn.addEventListener("click",()=>v(!1)),t.skipBtn.addEventListener("click",()=>v(!0)),t.finalizeBtn.addEventListener("click",function(){if(a.some(e=>null==e)&&!confirm("Some answers are blank. Finalize anyway?"))return;const e=new Date,l={player:t.playerName.value.trim()||"Anonymous",startedAt:d||i(e),submittedAt:i(e),flavours:[...n],order:[...o],answers:[...a],resolved:a.map(e=>null==e?null:n[e]||null)};r=!0,u(),t.resultBlock.innerHTML="",t.review.classList.add("hidden"),t.done.classList.remove("hidden");const s=t.webhook.value.trim();if(s)try{const e=s+"?data="+encodeURIComponent(JSON.stringify(l));fetch(e,{method:"GET",mode:"no-cors"}).then(()=>{const e=m("p",{className:"small muted"},["✓ Results sent to webhook"]);t.resultBlock.appendChild(e)}).catch(e=>{const n=m("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)})}catch(e){const n=m("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)}else{const e=m("p",{className:"small muted"},["⚠️ No webhook URL configured. Add ?webhook=URL to the page URL."]);t.resultBlock.appendChild(e)}}),function(){const i=localStorage.getItem("weirdSodaQuiz");if(i)try{const u=JSON.parse(i);Array.isArray(u.flavours)&&u.flavours.length===e&&(n=u.flavours,o=u.order??o,a=u.answers??a,l=c(u.current??0,0,11),s=c(u.editsRemaining??2,0,2),d=u.startedAt??null,r=!!u.submitted,t.playerName.value=u.playerName??"",t.webhook.value=u.webhook??"")}catch(e){console.warn("restore failed",e)}}(),function(){const e=new URLSearchParams(window.location.search).get("webhook");e&&(t.webhook.value=decodeURIComponent(e),u())}()}();