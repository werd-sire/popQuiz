!function(){const e=12,t={setup:document.getElementById("setup"),intro:document.getElementById("intro"),quiz:document.getElementById("quiz"),review:document.getElementById("review"),done:document.getElementById("done"),webhook:document.getElementById("webhook"),playerName:document.getElementById("playerName"),startBtn:document.getElementById("startBtn"),beginQuizBtn:document.getElementById("beginQuizBtn"),sampleNumber:document.getElementById("sampleNumber"),options:document.getElementById("flavourOptions"),allFlavoursPills:document.getElementById("allFlavoursPills"),nextBtn:document.getElementById("nextBtn"),skipBtn:document.getElementById("skipBtn"),bar:document.getElementById("bar"),progressText:document.getElementById("progressText"),editsLeft:document.getElementById("editsLeft"),reviewList:document.getElementById("reviewList"),finalizeBtn:document.getElementById("finalizeBtn"),resultBlock:document.getElementById("resultBlock"),downloadCsv:document.getElementById("downloadCsv"),copyJson:document.getElementById("copyJson")};let n=["Ketchup","Spaghetti","Cotton Candy","Pumpkin Pie","Pickle","Buffalo Wing","Ranch Dressing","Sweet Corn","Peanut Butter & Jelly","Bacon","Birthday Cake","Cucumber"],o=Array.from({length:e},(e,t)=>t+1),a=Array(e).fill(null),l=0,s=2,r=null,d=!1;const i=e=>new Date(e).toISOString(),c=(e,t,n)=>Math.max(t,Math.min(n,e));function u(){const e={flavours:n,order:o,answers:a,current:l,editsRemaining:s,startedAt:r,submitted:d,playerName:t.playerName.value,webhook:t.webhook.value};localStorage.setItem("weirdSodaQuiz",JSON.stringify(e))}function m(e,t={},n=[]){const o=document.createElement(e);Object.assign(o,t);for(const e of n)"string"==typeof e?o.appendChild(document.createTextNode(e)):e&&o.appendChild(e);return o}function p(){t.allFlavoursPills.innerHTML="",n.forEach((e,n)=>{t.allFlavoursPills.appendChild(m("div",{className:"pill"},[m("span",{className:"kbd"},[`#${n+1}`]),m("span",{},[e||"(blank)"])]))})}function h(){const n=a.filter(e=>null!==e).length;t.progressText.textContent=`${n}/12 answered`,t.bar.style.width=`${Math.round(n/e*100)}%`,t.sampleNumber.textContent=o[l]}function v(){t.options.innerHTML="";const s={};a.forEach((e,t)=>{null!==e&&t!==l&&(s[e]=o[t])});for(let o=0;o<e;o++){const e=`opt${o}`,r=s[o],d=void 0!==r,i=m("label",{className:d?"opt opt-used":"opt"}),c=m("input",{type:"radio",name:"flavour",id:e,value:o});d&&(c.disabled=!0,i.style.pointerEvents="none"),c.addEventListener("change",()=>{a[l]=o});const u=m("span",{},[n[o]||`(blank #${o+1})`]);if(i.appendChild(c),i.appendChild(u),d){const e=m("span",{className:"used-indicator"},[`Sample ${r}`]);i.appendChild(e)}t.options.appendChild(i)}if(null!=a[l]){const e=document.getElementById(`opt${a[l]}`);e&&(e.checked=!0)}}function y(e=!1){e||null!=a[l]?l<11?(l++,v(),h(),u(),window.scrollTo({top:0,behavior:"smooth"})):(t.quiz.classList.add("hidden"),t.review.classList.remove("hidden"),f(),u(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please pick a flavour or tap Skip.")}function f(){t.reviewList.innerHTML="",t.editsLeft.textContent=s;for(let l=0;l<e;l++){const e=o[l],s=a[l],r=null==s?"(no guess)":n[s]||`(blank #${s+1})`,d=m("div",{className:"opt",role:"button",tabIndex:0});d.appendChild(m("span",{className:"kbd"},[`Sample ${e}`])),d.appendChild(m("span",{},[r]));const i=m("span",{className:"muted",style:"margin-left:auto;font-size:12px"},["Edit"]);d.appendChild(i),d.addEventListener("click",()=>g(l)),d.addEventListener("keypress",e=>{"Enter"===e.key&&g(l)}),t.reviewList.appendChild(d)}}function g(t){if(s<=0)return void alert("No edits left.");const l=a[t],r=m("div",{className:"list"}),d=m("div",{},[`Change Sample ${o[t]}`]),i=m("select",{});for(let t=0;t<e;t++){const e=m("option",{value:t,text:n[t]||`(blank #${t+1})`});t===l&&(e.selected=!0),i.appendChild(e)}const c=m("button",{className:"good"},["Save change (-1 edit)"]),p=m("button",{className:"ghost"},["Cancel"]),h=m("dialog",{},[r]);r.appendChild(d),r.appendChild(i);const v=m("div",{className:"row"},[c,p]);if(r.appendChild(v),document.body.appendChild(h),!h.showModal)return alert("Your browser blocks modals; cannot edit here. Try another browser."),void h.remove();h.showModal(),c.addEventListener("click",()=>{a[t]=parseInt(i.value,10),s--,u(),h.close(),h.remove(),f()}),p.addEventListener("click",()=>{h.close(),h.remove()})}t.startBtn.addEventListener("click",()=>{t.playerName.value.trim()?(o=Array.from({length:e},(e,t)=>t+1),(e=>{for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}})(o),a=Array(e).fill(null),l=0,s=2,r=i(new Date),d=!1,u(),t.setup.classList.add("hidden"),t.quiz.classList.remove("hidden"),v(),p(),h(),window.scrollTo({top:0,behavior:"smooth"})):alert("Please enter your name.")}),t.beginQuizBtn.addEventListener("click",()=>{t.intro.classList.add("hidden"),t.quiz.classList.remove("hidden"),v(),p(),h(),window.scrollTo({top:0,behavior:"smooth"})}),t.nextBtn.addEventListener("click",()=>y(!1)),t.skipBtn.addEventListener("click",()=>y(!0)),t.finalizeBtn.addEventListener("click",function(){if(a.some(e=>null==e)&&!confirm("Some answers are blank. Finalize anyway?"))return;const e=new Date,l={player:t.playerName.value.trim()||"Anonymous",startedAt:r||i(e),submittedAt:i(e),flavours:[...n],order:[...o],answers:[...a],resolved:a.map(e=>null==e?null:n[e]||null)};d=!0,u(),t.resultBlock.innerHTML="";const s=m("pre",{style:"white-space:pre-wrap;word-break:break-word;background:#0f0f17;padding:12px;border-radius:12px;border:1px solid var(--border)"});s.textContent=JSON.stringify(l,null,2),t.resultBlock.appendChild(s),t.review.classList.add("hidden"),t.done.classList.remove("hidden");const c=t.webhook.value.trim();if(c)try{fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>{const n=m("p",{className:"small muted"},[`Webhook response: ${e.status} ${e.statusText}`]);t.resultBlock.appendChild(n)}).catch(e=>{const n=m("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)})}catch(e){const n=m("p",{className:"small muted"},[`Webhook error: ${String(e)}`]);t.resultBlock.appendChild(n)}}),t.downloadCsv.addEventListener("click",function(){const e=new Date,l={player:t.playerName.value.trim()||"Anonymous",startedAt:r,submittedAt:i(e),flavours:[...n],order:[...o],answers:[...a],resolved:a.map(e=>null==e?null:n[e]||null)},s=["player","submittedAt",...o.map(e=>`Sample${e}`),...o.map(e=>`Sample${e}_index`)].join(",")+"\n"+function(e){return[e.player,e.submittedAt,...e.resolved.map(e=>e??""),...e.answers.map(e=>null==e?"":e+1)].map(e=>(e=String(e),/[",\n]/.test(e)?'"'+e.replace(/"/g,'""')+'"':e)).join(",")}(l),d=new Blob([s],{type:"text/csv"}),c=document.createElement("a"),u=l.player.replace(/[^a-z0-9]+/gi,"_").replace(/^_+|_+$/g,"");c.download=`weird-soda-${u||"anonymous"}.csv`,c.href=URL.createObjectURL(d),c.click(),setTimeout(()=>URL.revokeObjectURL(c.href),2e3)}),t.copyJson.addEventListener("click",function(){const e=new Date,l={player:t.playerName.value.trim()||"Anonymous",startedAt:r,submittedAt:i(e),flavours:[...n],order:[...o],answers:[...a],resolved:a.map(e=>null==e?null:n[e]||null)};navigator.clipboard.writeText(JSON.stringify(l)).then(()=>{alert("Results copied to clipboard.")}).catch(()=>{alert("Copy failed. Select and copy from the box manually.")})}),function(){const i=localStorage.getItem("weirdSodaQuiz");if(i)try{const u=JSON.parse(i);Array.isArray(u.flavours)&&u.flavours.length===e&&(n=u.flavours,o=u.order??o,a=u.answers??a,l=c(u.current??0,0,11),s=c(u.editsRemaining??2,0,2),r=u.startedAt??null,d=!!u.submitted,t.playerName.value=u.playerName??"",t.webhook.value=u.webhook??"")}catch(e){console.warn("restore failed",e)}}(),function(){const e=new URLSearchParams(window.location.search).get("webhook");e&&(t.webhook.value=decodeURIComponent(e),u())}()}();